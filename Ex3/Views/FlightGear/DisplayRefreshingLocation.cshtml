@{
    ViewBag.Title = "DisplayRefreshingLocation";
}

<img id="map" src="~/Image/map.png" alt="map" style="position:absolute; height:100%; width:100%; top:0; left:0" ; />
<img id="airplane" src="~/Image/airplane.png" alt="airplane" style="position:absolute; height:25px; width:25px" ; />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<body>
    <script>
        var map = document.getElementById("map");

        var Lon = @Session["Lon"];
        var Lat = @Session["Lat"];
        console.log("Lon:" + Lon + "    Lat:" + Lat);
        var x = (Lon + 180) * (map.offsetWidth / 360);
        var y = (Lat + 90) * (map.offsetHeight / 180);
        var airplane = document.getElementById("airplane");
        airplane.style.top = y + "px";
        airplane.style.left = x + "px";

        Timer = (function () {
            $.post("@Url.Action("GetFlightData")").done(function (xml) {

                var xmlDoc = $.parseXML(xml),
                $xml = $(xmlDoc),
                Lat = $xml.find("Lat").text();
                Lon = $xml.find("Lon").text();
                console.log("LonA:" + Lon + "    LatA:" + Lat);

                $("#prodLon").text(Lon);
                $("#prodLat").text(Lat);

                x = (parseFloat(Lon) + 180) * (map.offsetWidth / 360);
                y = (parseFloat(Lat) + 90) * (map.offsetHeight / 180);
                console.log("LonB:" + Lon + "    LatB:" + Lat);
                console.log("map.offsetWidth:" + map.offsetWidth + "    map.offsetHeight:" + map.offsetHeight);
                console.log("X:" + x + "    Y:" + y);


                airplane.style.top = y + "px";
                airplane.style.left = x + "px";
            });
        });

        setInterval(Timer, @Session["Time"] * 1000);
        Timer();

    </script>
</body>

